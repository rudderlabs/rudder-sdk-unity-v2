name: Build UnityPackage
run-name: Creating a new .unitypackage for version 2022.3.16f1 ðŸš€
on:
  push:
    branches:
      - main
jobs:
  build-unitypackage:
    name: Build UnityPackage
    runs-on: ubuntu-latest

    steps:
      - name: Harden the runner (Audit all outbound calls)
        uses: step-security/harden-runner@f4a75cfd619ee5ce8d5b864b0d183aff3c69b55a # v2.13.1
        with:
          egress-policy: audit

      - name: Checkout Repository
        uses: actions/checkout@f43a0e5ff2bd294095638e18286ca9a3d1956744 # v3.6.0

      - name: Setup Unity
        uses: game-ci/unity-setup@v3
        with:
          unityVersion: '2022.3.16f1'
          activateLicense: false

      - name: Build UnityPackage
        run: |
          # Run Unity in batch mode to execute the export script
          xvfb-run --auto-servernum --server-args="-screen 0 640x480x24" \
          /opt/Unity/Editor/Unity \
          -batchmode \
          -nographics \
          -projectPath "$(pwd)" \
          -executeMethod UnityPackageExporter.ExportPackage \
          -quit

      - name: Upload UnityPackage
        uses: actions/upload-artifact@ff15f0306b3f739f7b6fd43fb5d26cd321bd4de5 # v3.2.1
        with:
          name: RudderStackUnityPackage
          path: RudderStackUnity.unitypackage
